!function(a,b){if("function"==typeof define&&define.amd)define("SnazzyInfoWindow",["module","exports"],b);else if("undefined"!=typeof exports)b(module,exports);else{var c={exports:{}};b(c,c.exports),a.SnazzyInfoWindow=c.exports}}(this,function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function e(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function f(a,b){a&&b&&Object.keys(b).forEach(function(c){a[c]=b[c]})}function g(a){var b={};return f(b,t),f(b,a),Object.keys(t).forEach(function(a){var c=t[a];if("object"===("undefined"==typeof c?"undefined":n(c))){var d={};f(d,c),f(d,b[a]),b[a]=d}}),b}function h(a,b){var c=/^(-{0,1}\.{0,1}\d+(\.\d+)?)[\s|\.]*(\w*)$/;if(a&&c.test(a)){var d=c.exec(a),e=d[1],f=d[3]||"px";return{value:1*e,units:f,original:a}}return b?h(b):{original:b}}function i(a,b){if(a){for(;a.firstChild;)a.removeChild(a.firstChild);b&&("string"==typeof b?a.innerHTML=b:a.appendChild(b))}}function j(a){return"top"===a?"bottom":"bottom"===a?"top":"left"===a?"right":"right"===a?"left":a}function k(a){return a.charAt(0).toUpperCase()+a.slice(1)}function l(a){if(void 0!==a&&null!==a&&google){if(a instanceof google.maps.LatLng)return a;if(void 0!==a.lat&&void 0!==a.lng)return new google.maps.LatLng(a)}return null}Object.defineProperty(b,"__esModule",{value:!0});var m=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},o="si-",p=1.41421356237,q=.7071067811865474,r="snazzy-info-window-",s={h:"0px",v:"3px",blur:"6px",spread:"0px",color:"#000"},t={placement:"top",pointer:!0,openOnMarkerClick:!0,closeOnMapClick:!0,closeWhenOthersOpen:!1,showCloseButton:!0,panOnOpen:!0,edgeOffset:{top:20,right:20,bottom:20,left:20}},u=function(a){function b(a){c(this,b);var e=d(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));e._html=null,e._opts=g(a),e._callbacks=e._opts.callbacks||{},e._marker=e._opts.marker,e._map=e._opts.map,e._position=l(e._opts.position),e._isOpen=!1,e._listeners=[],google&&e._marker&&e._opts.openOnMarkerClick&&e.trackListener(google.maps.event.addListener(e._marker,"click",function(){e.getMap()||e.open()}),!0),e._position&&!e._opts.offset&&(e._opts.offset={top:"0px",left:"0px"});var f=a.placement||e._opts.position;return("string"==typeof f||f instanceof String)&&(f=f.toLowerCase()),"top"!==f&&"bottom"!==f&&"left"!==f&&"right"!==f?e._opts.placement=t.placement:e._opts.placement=f,f=e._opts.position,void 0===f||null===f||"string"==typeof f||f instanceof String||(e._opts.position=f),void 0!==e._opts.border&&e._opts.border!==!0||(e._opts.border={}),void 0===e._opts.pointer&&(e._opts.pointer=t.pointer),void 0!==e._opts.shadow&&e._opts.shadow!==!0||(e._opts.shadow={}),e}return e(b,a),m(b,[{key:"activateCallback",value:function(a){var b=this._callbacks[a];return b?b.apply(this):void 0}},{key:"trackListener",value:function(a,b){this._listeners.push({listener:a,persistent:b})}},{key:"clearListeners",value:function(a){google&&this._listeners&&(this._listeners.forEach(function(b){!a&&b.persistent||(google.maps.event.removeListener(b.listener),b.listener=null)}),this._listeners=this._listeners.filter(function(a){return null!=a.listener}))}},{key:"isOpen",value:function(){return this._isOpen}},{key:"open",value:function(){var a=this.activateCallback("beforeOpen");(void 0===a||a)&&(this._marker?this.setMap(this._marker.getMap()):this._map&&this._position&&this.setMap(this._map))}},{key:"close",value:function(){var a=this.activateCallback("beforeClose");(void 0===a||a)&&(this.clearListeners(),this.setMap(null))}},{key:"destroy",value:function(){this.getMap()&&this.setMap(null),this.clearListeners(!0)}},{key:"setContent",value:function(a){this._opts.content=a,this._html&&this._html.content&&i(this._html.content,a)}},{key:"setPosition",value:function(a){this._position=l(a),this._isOpen&&this._position&&(this.draw(),this.resize(),this.reposition())}},{key:"getWrapper",value:function(){return this._html?this._html.wrapper:null}},{key:"draw",value:function(){if(this.getMap()&&this._html&&(this._marker||this._position)){var a=this._opts.offset;a&&(a.left&&(this._html.wrapper.style.marginLeft=a.left),a.top&&(this._html.wrapper.style.marginTop=a.top));var b=this._opts.backgroundColor;if(b&&(this._html.contentWrapper.style.backgroundColor=b,this._opts.pointer&&(this._html.pointerBg.style["border"+k(this._opts.placement)+"Color"]=b)),this._opts.padding&&(this._html.contentWrapper.style.padding=this._opts.padding,this._opts.shadow&&(this._html.shadowFrame.style.padding=this._opts.padding)),this._opts.borderRadius&&(this._html.contentWrapper.style.borderRadius=this._opts.borderRadius,this._opts.shadow&&(this._html.shadowFrame.style.borderRadius=this._opts.borderRadius)),this._opts.fontSize&&(this._html.wrapper.style.fontSize=this._opts.fontSize),this._opts.fontColor&&(this._html.contentWrapper.style.color=this._opts.fontColor),this._opts.pointer&&this._opts.pointer!==!0&&(this._opts.shadow&&(this._html.shadowPointer.style.width=this._opts.pointer,this._html.shadowPointer.style.height=this._opts.pointer),this._html.pointerBorder&&(this._html.pointerBorder.style.borderWidth=this._opts.pointer),this._html.pointerBg.style.borderWidth=this._opts.pointer),this._opts.border){var c=0;if(void 0!==this._opts.border.width&&(c=h(this._opts.border.width,"0px"),this._html.contentWrapper.style.borderWidth=c.value+c.units),c=Math.round((this._html.contentWrapper.offsetWidth-this._html.contentWrapper.clientWidth)/2),c=h(c+"px","0px"),this._opts.pointer){var d=Math.min(this._html.pointerBorder.offsetHeight,this._html.pointerBorder.offsetWidth);d=h(d+"px","0px");var e=Math.round(c.value*(p-1));e=Math.min(e,d.value),this._html.pointerBg.style.borderWidth=d.value-e+d.units;var f=k(j(this._opts.placement));this._html.pointerBg.style["margin"+f]=e+c.units,this._html.pointerBg.style[this._opts.placement]=-c.value+c.units}var g=this._opts.border.color;g&&(this._html.contentWrapper.style.borderColor=g,this._html.pointerBorder&&(this._html.pointerBorder.style["border"+k(this._opts.placement)+"Color"]=g))}if(this._opts.shadow){var i=this._opts.shadow,l=function(a){var b=i[a];return void 0!==b&&null!=b};if(l("h")||l("v")||l("blur")||l("spread")||l("color")){var m=h(i.h,s.h),n=h(i.v,s.v),o=h(i.blur,s.blur),t=h(i.spread,s.spread),u=i.color||s.color,v=function(a,b){return a+" "+b+" "+o.original+" "+t.original+" "+u};this._html.shadowFrame.style.boxShadow=v(m.original,n.original);var w=q*(m.value-n.value)+m.units,x=q*(m.value+n.value)+n.units;this._html.shadowPointerInner.style.boxShadow=v(w,x)}this._opts.shadow.opacity&&(this._html.shadowWrapper.style.opacity=this._opts.shadow.opacity)}var y=this.getProjection().fromLatLngToDivPixel(this._position||this._marker.position);y&&(this._html.floatWrapper.style.top=Math.floor(y.y)+"px",this._html.floatWrapper.style.left=Math.floor(y.x)+"px"),this._isOpen||(this._isOpen=!0,this.resize(),this.reposition(),this.activateCallback("afterOpen"),google&&google.maps.event.trigger(this.getMap(),r+"opened",this))}}},{key:"onAdd",value:function(){var a=this;if(!this._html){var b=function(a,b){if(a&&b)for(var c=0;c<b.length;c++){var d=b[c];d&&(a.className&&(a.className+=" "),a.className+=o+d)}},c=function(){for(var a=arguments.length,c=Array(a),d=0;d<a;d++)c[d]=arguments[d];var e=document.createElement("div");return b(e,c),e};if(this._html={},this._html.wrapper=c("wrapper-"+this._opts.placement),this._opts.wrapperClass&&(this._html.wrapper.className+=" "+this._opts.wrapperClass),this._opts.border&&b(this._html.wrapper,["has-border"]),this._opts.shadow&&(this._html.shadowWrapper=c("shadow-wrapper-"+this._opts.placement),this._html.shadowFrame=c("frame","shadow-frame"),this._html.shadowWrapper.appendChild(this._html.shadowFrame),this._opts.pointer&&(this._html.shadowPointer=c("shadow-pointer-"+this._opts.placement),this._html.shadowPointerInner=c("shadow-inner-pointer-"+this._opts.placement),this._html.shadowPointer.appendChild(this._html.shadowPointerInner),this._html.shadowWrapper.appendChild(this._html.shadowPointer)),this._html.wrapper.appendChild(this._html.shadowWrapper)),this._html.contentWrapper=c("frame","content-wrapper"),this._html.content=c("content"),this._opts.content&&i(this._html.content,this._opts.content),this._opts.showCloseButton){if(this._opts.closeButtonMarkup){var d=document.createElement("div");i(d,this._opts.closeButtonMarkup),this._html.closeButton=d.firstChild}else this._html.closeButton=document.createElement("button"),this._html.closeButton.setAttribute("type","button"),this._html.closeButton.innerHTML="&#215;",b(this._html.closeButton,["close-button"]);this._html.contentWrapper.appendChild(this._html.closeButton)}this._html.contentWrapper.appendChild(this._html.content),this._html.wrapper.appendChild(this._html.contentWrapper),this._opts.pointer&&(this._opts.border&&(this._html.pointerBorder=c("pointer-"+this._opts.placement,"pointer-border-"+this._opts.placement),this._html.wrapper.appendChild(this._html.pointerBorder)),this._html.pointerBg=c("pointer-"+this._opts.placement,"pointer-bg-"+this._opts.placement),this._html.wrapper.appendChild(this._html.pointerBg)),this._html.floatWrapper=c("float-wrapper"),this._html.floatWrapper.appendChild(this._html.wrapper),this.getPanes().floatPane.appendChild(this._html.floatWrapper);var e=this.getMap();if(this.clearListeners(),this._opts.closeOnMapClick&&this.trackListener(google.maps.event.addListener(e,"click",function(){a.close()})),this._opts.closeWhenOthersOpen&&this.trackListener(google.maps.event.addListener(e,r+"opened",function(b){a!==b&&a.close()})),google){this._previousWidth=null,this._previousHeight=null,this.trackListener(google.maps.event.addListener(e,"bounds_changed",function(){var b=e.getDiv(),c=b.offsetWidth,d=b.offsetHeight,f=a._previousWidth,g=a._previousHeight;null!==f&&null!==g&&f===c&&g===d||(a._previousWidth=c,a._previousHeight=d,a.resize())})),this._marker&&this.trackListener(google.maps.event.addListener(this._marker,"position_changed",function(){a.draw()})),this._opts.showCloseButton&&!this._opts.closeButtonMarkup&&this.trackListener(google.maps.event.addDomListener(this._html.closeButton,"click",function(b){b.cancelBubble=!0,b.stopPropagation&&b.stopPropagation(),a.close()}));var f=["click","dblclick","rightclick","contextmenu","drag","dragend","dragstart","mousedown","mouseout","mouseover","mouseup","touchstart","touchend","touchmove","wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"];f.forEach(function(b){a.trackListener(google.maps.event.addDomListener(a._html.wrapper,b,function(a){a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation()}))})}this.activateCallback("open")}}},{key:"onRemove",value:function(){if(this.activateCallback("close"),this._html){var a=this._html.floatWrapper.parentElement;a&&a.removeChild(this._html.floatWrapper),this._html=null}this._isOpen=!1,this.activateCallback("afterClose")}},{key:"getMapInnerBounds",value:function(){var a=this.getMap().getDiv().getBoundingClientRect(),b={top:a.top+this._opts.edgeOffset.top,right:a.right-this._opts.edgeOffset.right,bottom:a.bottom-this._opts.edgeOffset.bottom,left:a.left+this._opts.edgeOffset.left};return b.width=b.right-b.left,b.height=b.bottom-b.top,b}},{key:"reposition",value:function(){if(this._opts.panOnOpen&&this._html){var a=this.getMapInnerBounds(),b=this._html.wrapper.getBoundingClientRect(),c=0,d=0;a.left>=b.left?c=b.left-a.left:a.right<=b.right&&(c=b.left-(a.right-b.width)),a.top>=b.top?d=b.top-a.top:a.bottom<=b.bottom&&(d=b.top-(a.bottom-b.height)),0===c&&0===d||this.getMap().panBy(c,d)}}},{key:"resize",value:function(){if(this._html){var a=this.getMapInnerBounds(),b=a.width;void 0!==this._opts.maxWidth&&(b=Math.min(b,this._opts.maxWidth)),b-=this._html.wrapper.offsetWidth-this._html.content.offsetWidth,this._html.content.style.maxWidth=b+"px";var c=a.height;void 0!==this._opts.maxHeight&&(c=Math.min(c,this._opts.maxHeight)),c-=this._html.wrapper.offsetHeight-this._html.content.offsetHeight,this._html.content.style.maxHeight=c+"px"}}}]),b}(google.maps.OverlayView);b["default"]=u,a.exports=b["default"]});